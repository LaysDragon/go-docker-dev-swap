# ============================================
# Docker Dev Swap 多組配置範例（新結構）
# ============================================
# 此範例展示如何配置多個本地組件和主機
# 執行時會互動式選擇要使用的配置組合

# ============================================
# 全域預設值（可被 Component 層級覆蓋）
# ============================================
# 這些設定會作為所有 component 的預設值
# 如果 component 有自己的設定，將會覆蓋這些預設值

log_file: ""                                 # [可選] 日誌文件路徑，默認: "" (不寫入文件)
initial_scripts: ""                          # [可選] 初始化腳本，默認: ""
dlv_config:                                  # [可選] Delve 調試器全局設定
  enabled: false                             # 默認: false
  port: 2345                                 # 默認: 2345
  args: ""                                   # 默認: ""
  local_path: ""                             # 默認: "" (自動搜尋)

# ============================================
# 本地組件配置
# ============================================
components:
  # 組件 1: API 服務（使用全局預設值）
  api-service:
    name: "API 服務"
    local_binary: "./bin/api-service"
    target_service: "api"
    container_binary_path: "/app/service"    # 默認: /app/service
    debugger_port: 2345                      # 默認: 2345
    extra_ports: []                          # 默認: []
    # log_file: null                         # 使用全局預設
    # initial_scripts: null                  # 使用全局預設
    # dlv_config: null                       # 使用全局預設

  # 組件 2: Worker 服務（覆蓋日誌設定）
  worker-service:
    name: "Worker 服務"
    local_binary: "./bin/worker"
    target_service: "worker"
    debugger_port: 2346
    log_file: "./logs/worker.log"            # 覆蓋全局預設
    initial_scripts: |                       # 覆蓋全局預設
      echo "Worker 初始化"
      apk add --no-cache curl
    dlv_config:                              # 覆蓋全局預設
      enabled: true
      port: 2346

  # 組件 3: Scheduler（最簡配置）
  scheduler:
    name: "排程服務"
    local_binary: "./bin/scheduler"
    target_service: "scheduler"

# ============================================
# 主機配置（包含 mode, sudo, docker, projects）
# ============================================
hosts:
  # 主機 1: 遠端開發伺服器
  dev-server:
    name: "開發伺服器"
    mode: "remote"                           # [必要] "local" 或 "remote"
    host: "192.168.1.100"                    # [remote 必要] 主機地址
    port: 22                                 # [可選] SSH 端口，默認: 22
    user: "developer"                        # [remote 必要] SSH 用戶名
    password: "your-password"                # [必要/可選] SSH 密碼（或使用 key_file）
    # key_file: "/home/user/.ssh/id_rsa"     # [必要/可選] SSH 私鑰路徑
    
    remote_work_dir: "/tmp/dev-binaries"     # [可選] 遠端工作目錄，默認: /tmp/dev-binaries
    remote_binary_name: "service"            # [可選] 遠端執行檔名稱，默認: service
    
    # Sudo 配置
    use_sudo: false                          # [可選] 是否使用 sudo，默認: false
    sudo_password: ""                        # [可選] sudo 密碼，默認: ""
    
    # Docker 命令配置
    docker_command: "docker"                 # [可選] 默認: docker
    docker_compose_command: "docker compose" # [可選] 默認: docker compose
    
    # 該主機上的專案
    projects:
      microservices-app:
        name: "微服務應用"
        type: "compose"
        compose_dir: "/opt/microservices/app"
      
      data-pipeline:
        name: "數據處理流水線"
        type: "compose"
        compose_dir: "/opt/data-pipeline"

  # 主機 2: 測試環境（使用 SSH 金鑰）
  test-server:
    name: "測試伺服器"
    mode: "remote"
    host: "192.168.1.101"
    port: 22
    user: "tester"
    key_file: "/home/user/.ssh/test_rsa"
    
    use_sudo: true                           # 需要 sudo
    sudo_password: "test123"
    
    docker_command: "docker"
    docker_compose_command: "docker compose"
    
    projects:
      test-environment:
        name: "測試環境"
        type: "compose"
        compose_dir: "/home/tester/test-app"

  # 主機 3: 本地 Docker
  local-docker:
    name: "本地 Docker"
    mode: "local"                            # 本地模式
    
    # local 模式不需要 host, port, user, password 等
    
    use_sudo: false
    docker_command: "docker"
    docker_compose_command: "docker compose"
    
    projects:
      local-dev:
        name: "本地開發專案"
        type: "compose"
        compose_dir: "/home/user/projects/app"
      
      local-test:
        name: "本地測試"
        type: "compose"
        compose_dir: "/home/user/projects/test"

    # (未顯示) 每個 host 會自動獲得一個名稱為 "Docker Container" 的 container project，可直接針對現有容器操作。

# ============================================
# 配置結構說明
# ============================================
# 新結構的主要改變：
#
# 1. 全局層級：
#    - log_file, initial_scripts, dlv_config 作為預設值
#    - 可被 component 層級覆蓋
#
# 2. Host 層級包含：
#    - mode: "local" 或 "remote"
#    - sudo 配置：use_sudo, sudo_password
#    - docker 配置：docker_command, docker_compose_command
#    - projects: 該主機上的專案列表（嵌套結構）
#
# 3. Component 層級：
#    - log_file, initial_scripts, dlv_config 可選
#    - 如果設定為 null 或不設定，使用全局預設值
#    - 如果有值，覆蓋全局預設值
#
# 4. 選擇流程：
#    - 選擇 Component
#    - 選擇 Host (可以是 local 或 remote)
#    - 選擇該 Host 上的 Project
#
# ============================================
# 使用說明
# ============================================
# 1. 複製此文件為 config.yaml
# 2. 修改各配置項為你的實際設定
# 3. 執行程序時會使用互動式選擇器（支援鍵盤導航）依序選擇：
#    - 選擇本地組件 (components)
#    - 選擇主機 (hosts) - 顯示 local 或 remote 標籤
#    - 選擇該主機上的專案 (projects)
#
# 互動式選擇器操作方式：
#   - 使用 ↑/↓ 方向鍵移動選項
#   - 按 Enter 確認選擇
#   - 按 Ctrl+C 取消操作
#
# 注意：
#   - 如果某個類別只有一個選項，會自動選擇該選項
#   - local 模式主機不需要提供 SSH 連接資訊
